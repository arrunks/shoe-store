{"ast":null,"code":"var _jsxFileName = \"C:\\\\my-projects\\\\shoe-store\\\\lib\\\\withAuth.js\";\nvar __jsx = React.createElement;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport Router from 'next/router';\nimport cookies from 'next-cookies';\nimport { useQuery } from '@apollo/react-hooks';\nimport gql from 'graphql-tag';\nimport { withApollo } from '../lib/apollo';\nconst QUERY = gql`\n\tquery {\n\t\tme {\n\t\t\tusername\n\t\t\temail\n\t\t}\n\t}\n`;\nlet globalUser = null;\n\nfunction withAuth(BaseComponent, {\n  loginRequired = true,\n  logoutRequired = false\n} = {}) {\n  class App extends React.Component {\n    componentDidMount() {\n      const {\n        user,\n        isFromServer\n      } = this.props;\n\n      if (isFromServer) {\n        globalUser = user;\n      } // If login is required and not logged in, redirect to \"/login\" page\n\n\n      if (loginRequired && !logoutRequired && !user) {\n        Router.push('/signin');\n        return;\n      } // If logout is required and user logged in, redirect to \"/\" page\n\n\n      if (logoutRequired && user) {\n        Router.push('/');\n      }\n    }\n\n    static async getInitialProps(ctx) {\n      const isFromServer = !!ctx.req;\n      let user = globalUser;\n      const {\n        jwt\n      } = cookies(ctx);\n\n      if (jwt) {\n        const {\n          loading,\n          data\n        } = useQuery(QUERY);\n        user = data; // const res = await fetch('http://localhost:1337/users/me/', {\n        // \tmethod: 'GET',\n        // \theaders: {\n        // \t\tAuthorization: `Bearer ${jwt}`,\n        // \t},\n        // });\n        // user = await res.json();\n      }\n\n      if (isFromServer && user) {\n        // Convert \"_id\"(ObjectID from MongoDB) object to string\n        user._id = user._id.toString();\n      }\n\n      const props = {\n        user,\n        isFromServer\n      }; // Call child component's \"getInitialProps\", if it is defined\n\n      if (BaseComponent.getInitialProps) {\n        Object.assign(props, (await BaseComponent.getInitialProps(ctx)) || {});\n      }\n\n      return props;\n    }\n\n    render() {\n      const {\n        user\n      } = this.props;\n\n      if (loginRequired && !logoutRequired && !user) {\n        return null;\n      }\n\n      if (logoutRequired && user) {\n        return null;\n      }\n\n      return __jsx(BaseComponent, _extends({}, this.props, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 11\n        }\n      }));\n    }\n\n  }\n\n  _defineProperty(App, \"propTypes\", {\n    user: PropTypes.shape({\n      username: PropTypes.string,\n      email: PropTypes.string.isRequired\n    }),\n    isFromServer: PropTypes.bool.isRequired\n  });\n\n  _defineProperty(App, \"defaultProps\", {\n    user: null\n  });\n\n  return App;\n}\n\nexport default withAuth;","map":{"version":3,"sources":["C:/my-projects/shoe-store/lib/withAuth.js"],"names":["React","PropTypes","Router","cookies","useQuery","gql","withApollo","QUERY","globalUser","withAuth","BaseComponent","loginRequired","logoutRequired","App","Component","componentDidMount","user","isFromServer","props","push","getInitialProps","ctx","req","jwt","loading","data","_id","toString","Object","assign","render","shape","username","string","email","isRequired","bool"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport Router from 'next/router';\r\nimport cookies from 'next-cookies';\r\n\r\nimport { useQuery } from '@apollo/react-hooks';\r\nimport gql from 'graphql-tag';\r\nimport { withApollo } from '../lib/apollo';\r\n\r\nconst QUERY = gql`\r\n\tquery {\r\n\t\tme {\r\n\t\t\tusername\r\n\t\t\temail\r\n\t\t}\r\n\t}\r\n`;\r\n\r\nlet globalUser = null;\r\n\r\nfunction withAuth(BaseComponent, { loginRequired = true, logoutRequired = false } = {}) {\r\n\tclass App extends React.Component {\r\n\t\tstatic propTypes = {\r\n\t\t\tuser: PropTypes.shape({\r\n\t\t\t\tusername: PropTypes.string,\r\n\t\t\t\temail: PropTypes.string.isRequired,\r\n\t\t\t}),\r\n\t\t\tisFromServer: PropTypes.bool.isRequired,\r\n\t\t};\r\n\r\n\t\tstatic defaultProps = {\r\n\t\t\tuser: null,\r\n\t\t};\r\n\r\n\t\tcomponentDidMount() {\r\n\t\t\tconst { user, isFromServer } = this.props;\r\n\r\n\t\t\tif (isFromServer) {\r\n\t\t\t\tglobalUser = user;\r\n\t\t\t}\r\n\r\n\t\t\t// If login is required and not logged in, redirect to \"/login\" page\r\n\t\t\tif (loginRequired && !logoutRequired && !user) {\r\n\t\t\t\tRouter.push('/signin');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// If logout is required and user logged in, redirect to \"/\" page\r\n\t\t\tif (logoutRequired && user) {\r\n\t\t\t\tRouter.push('/');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tstatic async getInitialProps(ctx) {\r\n\t\t\tconst isFromServer = !!ctx.req;\r\n\r\n\t\t\tlet user = globalUser;\r\n\r\n\t\t\tconst { jwt } = cookies(ctx);\r\n\t\t\tif (jwt) {\r\n\t\t\t\tconst { loading, data } = useQuery(QUERY);\r\n\t\t\t\tuser = data;\r\n\t\t\t\t// const res = await fetch('http://localhost:1337/users/me/', {\r\n\t\t\t\t// \tmethod: 'GET',\r\n\t\t\t\t// \theaders: {\r\n\t\t\t\t// \t\tAuthorization: `Bearer ${jwt}`,\r\n\t\t\t\t// \t},\r\n\t\t\t\t// });\r\n\t\t\t\t// user = await res.json();\r\n\t\t\t}\r\n\r\n\t\t\tif (isFromServer && user) {\r\n\t\t\t\t// Convert \"_id\"(ObjectID from MongoDB) object to string\r\n\t\t\t\tuser._id = user._id.toString();\r\n\t\t\t}\r\n\r\n\t\t\tconst props = { user, isFromServer };\r\n\r\n\t\t\t// Call child component's \"getInitialProps\", if it is defined\r\n\t\t\tif (BaseComponent.getInitialProps) {\r\n\t\t\t\tObject.assign(props, (await BaseComponent.getInitialProps(ctx)) || {});\r\n\t\t\t}\r\n\r\n\t\t\treturn props;\r\n\t\t}\r\n\r\n\t\trender() {\r\n\t\t\tconst { user } = this.props;\r\n\r\n\t\t\tif (loginRequired && !logoutRequired && !user) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tif (logoutRequired && user) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\treturn <BaseComponent {...this.props} />;\r\n\t\t}\r\n\t}\r\n\r\n\treturn App;\r\n}\r\n\r\nexport default withAuth;\r\n"]},"metadata":{},"sourceType":"module"}