{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function () { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from 'react';\nimport Router from 'next/router';\nimport cookies from 'next-cookies';\nvar globalUser = null;\n\nfunction withAuth(BaseComponent) {\n  var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n      _ref$loginRequired = _ref.loginRequired,\n      loginRequired = _ref$loginRequired === void 0 ? true : _ref$loginRequired,\n      _ref$logoutRequired = _ref.logoutRequired,\n      logoutRequired = _ref$logoutRequired === void 0 ? false : _ref$logoutRequired;\n\n  var App = /*#__PURE__*/function (_React$Component) {\n    _inherits(App, _React$Component);\n\n    var _super = _createSuper(App);\n\n    function App() {\n      _classCallCheck(this, App);\n\n      return _super.apply(this, arguments);\n    }\n\n    _createClass(App, [{\n      key: \"componentDidMount\",\n      value: function componentDidMount() {\n        var _this$props = this.props,\n            user = _this$props.user,\n            isFromServer = _this$props.isFromServer;\n\n        if (isFromServer) {\n          globalUser = user;\n        } // If login is required and not logged in, redirect to \"/login\" page\n\n\n        if (loginRequired && !logoutRequired && !user) {\n          Router.push('/signin');\n          return;\n        } // If logout is required and user logged in, redirect to \"/\" page\n\n\n        if (logoutRequired && user) {\n          Router.push('/');\n        }\n      }\n    }, {\n      key: \"render\",\n      value: function render() {\n        var user = this.props.user;\n\n        if (loginRequired && !logoutRequired && !user) {\n          return null;\n        }\n\n        if (logoutRequired && user) {\n          return null;\n        }\n\n        return __jsx(BaseComponent, this.props);\n      }\n    }], [{\n      key: \"getInitialProps\",\n      value: function () {\n        var _getInitialProps = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(ctx) {\n          var isFromServer, user, _cookies, jwt, res, props;\n\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  isFromServer = !!ctx.req;\n                  user = globalUser;\n                  _cookies = cookies(ctx), jwt = _cookies.jwt;\n\n                  if (!jwt) {\n                    _context.next = 10;\n                    break;\n                  }\n\n                  _context.next = 6;\n                  return fetch(\"\".concat(process.env.backendUrl, \"/users/me/\"), {\n                    method: 'GET',\n                    headers: {\n                      Authorization: \"Bearer \".concat(jwt)\n                    }\n                  });\n\n                case 6:\n                  res = _context.sent;\n                  _context.next = 9;\n                  return res.json();\n\n                case 9:\n                  user = _context.sent;\n\n                case 10:\n                  if (isFromServer && user) {\n                    // Convert \"_id\"(ObjectID from MongoDB) object to string\n                    user._id = user._id.toString();\n                  }\n\n                  props = {\n                    user: user,\n                    isFromServer: isFromServer\n                  }; // Call child component's \"getInitialProps\", if it is defined\n\n                  if (!BaseComponent.getInitialProps) {\n                    _context.next = 22;\n                    break;\n                  }\n\n                  _context.t0 = Object;\n                  _context.t1 = props;\n                  _context.next = 17;\n                  return BaseComponent.getInitialProps(ctx);\n\n                case 17:\n                  _context.t2 = _context.sent;\n\n                  if (_context.t2) {\n                    _context.next = 20;\n                    break;\n                  }\n\n                  _context.t2 = {};\n\n                case 20:\n                  _context.t3 = _context.t2;\n\n                  _context.t0.assign.call(_context.t0, _context.t1, _context.t3);\n\n                case 22:\n                  return _context.abrupt(\"return\", props);\n\n                case 23:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        function getInitialProps(_x) {\n          return _getInitialProps.apply(this, arguments);\n        }\n\n        return getInitialProps;\n      }()\n    }]);\n\n    return App;\n  }(React.Component);\n\n  _defineProperty(App, \"defaultProps\", {\n    user: null\n  });\n\n  return App;\n}\n\nexport default withAuth;","map":null,"metadata":{},"sourceType":"module"}