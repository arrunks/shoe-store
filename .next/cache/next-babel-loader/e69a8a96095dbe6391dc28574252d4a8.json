{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _taggedTemplateLiteral from \"@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nvar _jsxFileName = \"C:\\\\my-projects\\\\shoe-store\\\\lib\\\\withAuth.js\";\nvar __jsx = React.createElement;\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function () { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n\\tquery {\\n\\t\\tme {\\n\\t\\t\\tusername\\n\\t\\t\\temail\\n\\t\\t}\\n\\t}\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport Router from 'next/router';\nimport cookies from 'next-cookies';\nimport { useQuery } from '@apollo/react-hooks';\nimport gql from 'graphql-tag';\nimport { withApollo } from '../lib/apollo';\nvar QUERY = gql(_templateObject());\nvar globalUser = null;\n\nfunction withAuth(BaseComponent) {\n  var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n      _ref$loginRequired = _ref.loginRequired,\n      loginRequired = _ref$loginRequired === void 0 ? true : _ref$loginRequired,\n      _ref$logoutRequired = _ref.logoutRequired,\n      logoutRequired = _ref$logoutRequired === void 0 ? false : _ref$logoutRequired;\n\n  var App = /*#__PURE__*/function (_React$Component) {\n    _inherits(App, _React$Component);\n\n    var _super = _createSuper(App);\n\n    function App() {\n      _classCallCheck(this, App);\n\n      return _super.apply(this, arguments);\n    }\n\n    _createClass(App, [{\n      key: \"componentDidMount\",\n      value: function componentDidMount() {\n        var _this$props = this.props,\n            user = _this$props.user,\n            isFromServer = _this$props.isFromServer;\n\n        if (isFromServer) {\n          globalUser = user;\n        } // If login is required and not logged in, redirect to \"/login\" page\n\n\n        if (loginRequired && !logoutRequired && !user) {\n          Router.push('/signin');\n          return;\n        } // If logout is required and user logged in, redirect to \"/\" page\n\n\n        if (logoutRequired && user) {\n          Router.push('/');\n        }\n      }\n    }, {\n      key: \"render\",\n      value: function render() {\n        var user = this.props.user;\n\n        if (loginRequired && !logoutRequired && !user) {\n          return null;\n        }\n\n        if (logoutRequired && user) {\n          return null;\n        }\n\n        return __jsx(BaseComponent, _extends({}, this.props, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 98,\n            columnNumber: 11\n          }\n        }));\n      }\n    }], [{\n      key: \"getInitialProps\",\n      value: function () {\n        var _getInitialProps = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(ctx) {\n          var isFromServer, user, _cookies, jwt, _useQuery, loading, data, props;\n\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  isFromServer = !!ctx.req;\n                  user = globalUser;\n                  _cookies = cookies(ctx), jwt = _cookies.jwt;\n\n                  if (jwt) {\n                    _useQuery = useQuery(QUERY), loading = _useQuery.loading, data = _useQuery.data;\n                    user = data; // const res = await fetch('http://localhost:1337/users/me/', {\n                    // \tmethod: 'GET',\n                    // \theaders: {\n                    // \t\tAuthorization: `Bearer ${jwt}`,\n                    // \t},\n                    // });\n                    // user = await res.json();\n                  }\n\n                  if (isFromServer && user) {\n                    // Convert \"_id\"(ObjectID from MongoDB) object to string\n                    user._id = user._id.toString();\n                  }\n\n                  props = {\n                    user: user,\n                    isFromServer: isFromServer\n                  }; // Call child component's \"getInitialProps\", if it is defined\n\n                  if (!BaseComponent.getInitialProps) {\n                    _context.next = 16;\n                    break;\n                  }\n\n                  _context.t0 = Object;\n                  _context.t1 = props;\n                  _context.next = 11;\n                  return BaseComponent.getInitialProps(ctx);\n\n                case 11:\n                  _context.t2 = _context.sent;\n\n                  if (_context.t2) {\n                    _context.next = 14;\n                    break;\n                  }\n\n                  _context.t2 = {};\n\n                case 14:\n                  _context.t3 = _context.t2;\n\n                  _context.t0.assign.call(_context.t0, _context.t1, _context.t3);\n\n                case 16:\n                  return _context.abrupt(\"return\", props);\n\n                case 17:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        function getInitialProps(_x) {\n          return _getInitialProps.apply(this, arguments);\n        }\n\n        return getInitialProps;\n      }()\n    }]);\n\n    return App;\n  }(React.Component);\n\n  _defineProperty(App, \"propTypes\", {\n    user: PropTypes.shape({\n      username: PropTypes.string,\n      email: PropTypes.string.isRequired\n    }),\n    isFromServer: PropTypes.bool.isRequired\n  });\n\n  _defineProperty(App, \"defaultProps\", {\n    user: null\n  });\n\n  return App;\n}\n\nexport default withAuth;","map":{"version":3,"sources":["C:/my-projects/shoe-store/lib/withAuth.js"],"names":["React","PropTypes","Router","cookies","useQuery","gql","withApollo","QUERY","globalUser","withAuth","BaseComponent","loginRequired","logoutRequired","App","props","user","isFromServer","push","ctx","req","jwt","loading","data","_id","toString","getInitialProps","Object","assign","Component","shape","username","string","email","isRequired","bool"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,OAAOC,MAAP,MAAmB,aAAnB;AACA,OAAOC,OAAP,MAAoB,cAApB;AAEA,SAASC,QAAT,QAAyB,qBAAzB;AACA,OAAOC,GAAP,MAAgB,aAAhB;AACA,SAASC,UAAT,QAA2B,eAA3B;AAEA,IAAMC,KAAK,GAAGF,GAAH,mBAAX;AASA,IAAIG,UAAU,GAAG,IAAjB;;AAEA,SAASC,QAAT,CAAkBC,aAAlB,EAAwF;AAAA,iFAAJ,EAAI;AAAA,gCAArDC,aAAqD;AAAA,MAArDA,aAAqD,mCAArC,IAAqC;AAAA,iCAA/BC,cAA+B;AAAA,MAA/BA,cAA+B,oCAAd,KAAc;;AAAA,MACjFC,GADiF;AAAA;;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA,0CAclE;AAAA,0BACY,KAAKC,KADjB;AAAA,YACXC,IADW,eACXA,IADW;AAAA,YACLC,YADK,eACLA,YADK;;AAGnB,YAAIA,YAAJ,EAAkB;AACjBR,UAAAA,UAAU,GAAGO,IAAb;AACA,SALkB,CAOnB;;;AACA,YAAIJ,aAAa,IAAI,CAACC,cAAlB,IAAoC,CAACG,IAAzC,EAA+C;AAC9Cb,UAAAA,MAAM,CAACe,IAAP,CAAY,SAAZ;AACA;AACA,SAXkB,CAanB;;;AACA,YAAIL,cAAc,IAAIG,IAAtB,EAA4B;AAC3Bb,UAAAA,MAAM,CAACe,IAAP,CAAY,GAAZ;AACA;AACD;AA/BqF;AAAA;AAAA,+BAkE7E;AAAA,YACAF,IADA,GACS,KAAKD,KADd,CACAC,IADA;;AAGR,YAAIJ,aAAa,IAAI,CAACC,cAAlB,IAAoC,CAACG,IAAzC,EAA+C;AAC9C,iBAAO,IAAP;AACA;;AAED,YAAIH,cAAc,IAAIG,IAAtB,EAA4B;AAC3B,iBAAO,IAAP;AACA;;AAED,eAAO,MAAC,aAAD,eAAmB,KAAKD,KAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAAP;AACA;AA9EqF;AAAA;AAAA;AAAA,yGAiCzDI,GAjCyD;AAAA;;AAAA;AAAA;AAAA;AAAA;AAkC/EF,kBAAAA,YAlC+E,GAkChE,CAAC,CAACE,GAAG,CAACC,GAlC0D;AAoCjFJ,kBAAAA,IApCiF,GAoC1EP,UApC0E;AAAA,6BAsCrEL,OAAO,CAACe,GAAD,CAtC8D,EAsC7EE,GAtC6E,YAsC7EA,GAtC6E;;AAuCrF,sBAAIA,GAAJ,EAAS;AAAA,gCACkBhB,QAAQ,CAACG,KAAD,CAD1B,EACAc,OADA,aACAA,OADA,EACSC,IADT,aACSA,IADT;AAERP,oBAAAA,IAAI,GAAGO,IAAP,CAFQ,CAGR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAED,sBAAIN,YAAY,IAAID,IAApB,EAA0B;AACzB;AACAA,oBAAAA,IAAI,CAACQ,GAAL,GAAWR,IAAI,CAACQ,GAAL,CAASC,QAAT,EAAX;AACA;;AAEKV,kBAAAA,KAxD+E,GAwDvE;AAAEC,oBAAAA,IAAI,EAAJA,IAAF;AAAQC,oBAAAA,YAAY,EAAZA;AAAR,mBAxDuE,EA0DrF;;AA1DqF,uBA2DjFN,aAAa,CAACe,eA3DmE;AAAA;AAAA;AAAA;;AAAA,gCA4DpFC,MA5DoF;AAAA,gCA4DtEZ,KA5DsE;AAAA;AAAA,yBA4DxDJ,aAAa,CAACe,eAAd,CAA8BP,GAA9B,CA5DwD;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA,gCA4DjB,EA5DiB;;AAAA;AAAA;;AAAA,8BA4D7ES,MA5D6E;;AAAA;AAAA,mDA+D9Eb,KA/D8E;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,IACrEd,KAAK,CAAC4B,SAD+D;;AAAA,kBACjFf,GADiF,eAEnE;AAClBE,IAAAA,IAAI,EAAEd,SAAS,CAAC4B,KAAV,CAAgB;AACrBC,MAAAA,QAAQ,EAAE7B,SAAS,CAAC8B,MADC;AAErBC,MAAAA,KAAK,EAAE/B,SAAS,CAAC8B,MAAV,CAAiBE;AAFH,KAAhB,CADY;AAKlBjB,IAAAA,YAAY,EAAEf,SAAS,CAACiC,IAAV,CAAeD;AALX,GAFmE;;AAAA,kBACjFpB,GADiF,kBAUhE;AACrBE,IAAAA,IAAI,EAAE;AADe,GAVgE;;AAiFvF,SAAOF,GAAP;AACA;;AAED,eAAeJ,QAAf","sourcesContent":["import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport Router from 'next/router';\r\nimport cookies from 'next-cookies';\r\n\r\nimport { useQuery } from '@apollo/react-hooks';\r\nimport gql from 'graphql-tag';\r\nimport { withApollo } from '../lib/apollo';\r\n\r\nconst QUERY = gql`\r\n\tquery {\r\n\t\tme {\r\n\t\t\tusername\r\n\t\t\temail\r\n\t\t}\r\n\t}\r\n`;\r\n\r\nlet globalUser = null;\r\n\r\nfunction withAuth(BaseComponent, { loginRequired = true, logoutRequired = false } = {}) {\r\n\tclass App extends React.Component {\r\n\t\tstatic propTypes = {\r\n\t\t\tuser: PropTypes.shape({\r\n\t\t\t\tusername: PropTypes.string,\r\n\t\t\t\temail: PropTypes.string.isRequired,\r\n\t\t\t}),\r\n\t\t\tisFromServer: PropTypes.bool.isRequired,\r\n\t\t};\r\n\r\n\t\tstatic defaultProps = {\r\n\t\t\tuser: null,\r\n\t\t};\r\n\r\n\t\tcomponentDidMount() {\r\n\t\t\tconst { user, isFromServer } = this.props;\r\n\r\n\t\t\tif (isFromServer) {\r\n\t\t\t\tglobalUser = user;\r\n\t\t\t}\r\n\r\n\t\t\t// If login is required and not logged in, redirect to \"/login\" page\r\n\t\t\tif (loginRequired && !logoutRequired && !user) {\r\n\t\t\t\tRouter.push('/signin');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// If logout is required and user logged in, redirect to \"/\" page\r\n\t\t\tif (logoutRequired && user) {\r\n\t\t\t\tRouter.push('/');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tstatic async getInitialProps(ctx) {\r\n\t\t\tconst isFromServer = !!ctx.req;\r\n\r\n\t\t\tlet user = globalUser;\r\n\r\n\t\t\tconst { jwt } = cookies(ctx);\r\n\t\t\tif (jwt) {\r\n\t\t\t\tconst { loading, data } = useQuery(QUERY);\r\n\t\t\t\tuser = data;\r\n\t\t\t\t// const res = await fetch('http://localhost:1337/users/me/', {\r\n\t\t\t\t// \tmethod: 'GET',\r\n\t\t\t\t// \theaders: {\r\n\t\t\t\t// \t\tAuthorization: `Bearer ${jwt}`,\r\n\t\t\t\t// \t},\r\n\t\t\t\t// });\r\n\t\t\t\t// user = await res.json();\r\n\t\t\t}\r\n\r\n\t\t\tif (isFromServer && user) {\r\n\t\t\t\t// Convert \"_id\"(ObjectID from MongoDB) object to string\r\n\t\t\t\tuser._id = user._id.toString();\r\n\t\t\t}\r\n\r\n\t\t\tconst props = { user, isFromServer };\r\n\r\n\t\t\t// Call child component's \"getInitialProps\", if it is defined\r\n\t\t\tif (BaseComponent.getInitialProps) {\r\n\t\t\t\tObject.assign(props, (await BaseComponent.getInitialProps(ctx)) || {});\r\n\t\t\t}\r\n\r\n\t\t\treturn props;\r\n\t\t}\r\n\r\n\t\trender() {\r\n\t\t\tconst { user } = this.props;\r\n\r\n\t\t\tif (loginRequired && !logoutRequired && !user) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tif (logoutRequired && user) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\treturn <BaseComponent {...this.props} />;\r\n\t\t}\r\n\t}\r\n\r\n\treturn App;\r\n}\r\n\r\nexport default withAuth;\r\n"]},"metadata":{},"sourceType":"module"}