{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar _jsxFileName = \"C:\\\\my-projects\\\\shoe-store\\\\lib\\\\withAuth.js\";\nvar __jsx = React.createElement;\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function () { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport Router from 'next/router';\nimport cookies from 'next-cookies';\nvar globalUser = null;\n\nfunction withAuth(BaseComponent) {\n  var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n      _ref$loginRequired = _ref.loginRequired,\n      loginRequired = _ref$loginRequired === void 0 ? true : _ref$loginRequired,\n      _ref$logoutRequired = _ref.logoutRequired,\n      logoutRequired = _ref$logoutRequired === void 0 ? false : _ref$logoutRequired;\n\n  var App = /*#__PURE__*/function (_React$Component) {\n    _inherits(App, _React$Component);\n\n    var _super = _createSuper(App);\n\n    function App() {\n      _classCallCheck(this, App);\n\n      return _super.apply(this, arguments);\n    }\n\n    _createClass(App, [{\n      key: \"componentDidMount\",\n      value: function componentDidMount() {\n        var _this$props = this.props,\n            user = _this$props.user,\n            isFromServer = _this$props.isFromServer;\n\n        if (isFromServer) {\n          globalUser = user;\n        } // If login is required and not logged in, redirect to \"/login\" page\n\n\n        if (loginRequired && !logoutRequired && !user) {\n          Router.push('/signin');\n          return;\n        } // If logout is required and user logged in, redirect to \"/\" page\n\n\n        if (logoutRequired && user) {\n          Router.push('/');\n        }\n      }\n    }, {\n      key: \"render\",\n      value: function render() {\n        var user = this.props.user;\n\n        if (loginRequired && !logoutRequired && !user) {\n          return null;\n        }\n\n        if (logoutRequired && user) {\n          return null;\n        }\n\n        return __jsx(BaseComponent, _extends({}, this.props, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 83,\n            columnNumber: 11\n          }\n        }));\n      }\n    }], [{\n      key: \"getInitialProps\",\n      value: function () {\n        var _getInitialProps = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(ctx) {\n          var isFromServer, user, _cookies, jwt, res, props;\n\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  isFromServer = !!ctx.req;\n                  user = globalUser;\n                  _cookies = cookies(ctx), jwt = _cookies.jwt;\n\n                  if (!jwt) {\n                    _context.next = 10;\n                    break;\n                  }\n\n                  _context.next = 6;\n                  return fetch(\"\".concat(process.env.backendUrl, \"/users/me/\"), {\n                    method: 'GET',\n                    headers: {\n                      Authorization: \"Bearer \".concat(jwt)\n                    }\n                  });\n\n                case 6:\n                  res = _context.sent;\n                  _context.next = 9;\n                  return res.json();\n\n                case 9:\n                  user = _context.sent;\n\n                case 10:\n                  if (isFromServer && user) {\n                    // Convert \"_id\"(ObjectID from MongoDB) object to string\n                    user._id = user._id.toString();\n                  }\n\n                  props = {\n                    user: user,\n                    isFromServer: isFromServer\n                  }; // Call child component's \"getInitialProps\", if it is defined\n\n                  if (!BaseComponent.getInitialProps) {\n                    _context.next = 22;\n                    break;\n                  }\n\n                  _context.t0 = Object;\n                  _context.t1 = props;\n                  _context.next = 17;\n                  return BaseComponent.getInitialProps(ctx);\n\n                case 17:\n                  _context.t2 = _context.sent;\n\n                  if (_context.t2) {\n                    _context.next = 20;\n                    break;\n                  }\n\n                  _context.t2 = {};\n\n                case 20:\n                  _context.t3 = _context.t2;\n\n                  _context.t0.assign.call(_context.t0, _context.t1, _context.t3);\n\n                case 22:\n                  return _context.abrupt(\"return\", props);\n\n                case 23:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n\n        function getInitialProps(_x) {\n          return _getInitialProps.apply(this, arguments);\n        }\n\n        return getInitialProps;\n      }()\n    }]);\n\n    return App;\n  }(React.Component);\n\n  _defineProperty(App, \"propTypes\", {\n    user: PropTypes.shape({\n      username: PropTypes.string,\n      email: PropTypes.string.isRequired\n    }),\n    isFromServer: PropTypes.bool.isRequired\n  });\n\n  _defineProperty(App, \"defaultProps\", {\n    user: null\n  });\n\n  return App;\n}\n\nexport default withAuth;","map":{"version":3,"sources":["C:/my-projects/shoe-store/lib/withAuth.js"],"names":["React","PropTypes","Router","cookies","globalUser","withAuth","BaseComponent","loginRequired","logoutRequired","App","props","user","isFromServer","push","ctx","req","jwt","fetch","process","env","backendUrl","method","headers","Authorization","res","json","_id","toString","getInitialProps","Object","assign","Component","shape","username","string","email","isRequired","bool"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport Router from 'next/router';\r\nimport cookies from 'next-cookies';\r\n\r\nlet globalUser = null;\r\n\r\nfunction withAuth(BaseComponent, { loginRequired = true, logoutRequired = false } = {}) {\r\n\tclass App extends React.Component {\r\n\t\tstatic propTypes = {\r\n\t\t\tuser: PropTypes.shape({\r\n\t\t\t\tusername: PropTypes.string,\r\n\t\t\t\temail: PropTypes.string.isRequired,\r\n\t\t\t}),\r\n\t\t\tisFromServer: PropTypes.bool.isRequired,\r\n\t\t};\r\n\r\n\t\tstatic defaultProps = {\r\n\t\t\tuser: null,\r\n\t\t};\r\n\r\n\t\tcomponentDidMount() {\r\n\t\t\tconst { user, isFromServer } = this.props;\r\n\r\n\t\t\tif (isFromServer) {\r\n\t\t\t\tglobalUser = user;\r\n\t\t\t}\r\n\r\n\t\t\t// If login is required and not logged in, redirect to \"/login\" page\r\n\t\t\tif (loginRequired && !logoutRequired && !user) {\r\n\t\t\t\tRouter.push('/signin');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// If logout is required and user logged in, redirect to \"/\" page\r\n\t\t\tif (logoutRequired && user) {\r\n\t\t\t\tRouter.push('/');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tstatic async getInitialProps(ctx) {\r\n\t\t\tconst isFromServer = !!ctx.req;\r\n\r\n\t\t\tlet user = globalUser;\r\n\r\n\t\t\tconst { jwt } = cookies(ctx);\r\n\t\t\tif (jwt) {\r\n\t\t\t\tconst res = await fetch(`${process.env.backendUrl}/users/me/`, {\r\n\t\t\t\t\tmethod: 'GET',\r\n\t\t\t\t\theaders: {\r\n\t\t\t\t\t\tAuthorization: `Bearer ${jwt}`,\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t\tuser = await res.json();\r\n\t\t\t}\r\n\r\n\t\t\tif (isFromServer && user) {\r\n\t\t\t\t// Convert \"_id\"(ObjectID from MongoDB) object to string\r\n\t\t\t\tuser._id = user._id.toString();\r\n\t\t\t}\r\n\r\n\t\t\tconst props = { user, isFromServer };\r\n\r\n\t\t\t// Call child component's \"getInitialProps\", if it is defined\r\n\t\t\tif (BaseComponent.getInitialProps) {\r\n\t\t\t\tObject.assign(props, (await BaseComponent.getInitialProps(ctx)) || {});\r\n\t\t\t}\r\n\r\n\t\t\treturn props;\r\n\t\t}\r\n\r\n\t\trender() {\r\n\t\t\tconst { user } = this.props;\r\n\r\n\t\t\tif (loginRequired && !logoutRequired && !user) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tif (logoutRequired && user) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\treturn <BaseComponent {...this.props} />;\r\n\t\t}\r\n\t}\r\n\r\n\treturn App;\r\n}\r\n\r\nexport default withAuth;\r\n"]},"metadata":{},"sourceType":"module"}