{"ast":null,"code":"var _jsxFileName = \"C:\\\\my-projects\\\\shoe-store\\\\lib\\\\withAuth.js\";\nvar __jsx = React.createElement;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport Router from 'next/router';\nlet globalUser = null;\n\nfunction withAuth(BaseComponent, {\n  loginRequired = true,\n  logoutRequired = false\n} = {}) {\n  class App extends React.Component {\n    componentDidMount() {\n      const {\n        user,\n        isFromServer\n      } = this.props;\n\n      if (isFromServer) {\n        globalUser = user;\n      } // If login is required and not logged in, redirect to \"/login\" page\n\n\n      if (loginRequired && !logoutRequired && !user) {\n        Router.push('/login');\n        return;\n      } // If logout is required and user logged in, redirect to \"/\" page\n\n\n      if (logoutRequired && user) {\n        Router.push('/');\n      }\n    }\n\n    static async getInitialProps(ctx) {\n      const isFromServer = !!ctx.req;\n      const user = ctx.req ? ctx.req.user && ctx.req.user.toObject() : globalUser;\n\n      if (isFromServer && user) {\n        // Convert \"_id\"(ObjectID from MongoDB) object to string\n        user._id = user._id.toString();\n      }\n\n      const props = {\n        user,\n        isFromServer\n      }; // Call child component's \"getInitialProps\", if it is defined\n\n      console.log(props);\n\n      if (BaseComponent.getInitialProps) {\n        Object.assign(props, (await BaseComponent.getInitialProps(ctx)) || {});\n      }\n\n      return props;\n    }\n\n    render() {\n      const {\n        user\n      } = this.props;\n\n      if (loginRequired && !logoutRequired && !user) {\n        return null;\n      }\n\n      if (logoutRequired && user) {\n        return null;\n      }\n\n      return __jsx(BaseComponent, _extends({}, this.props, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 71,\n          columnNumber: 11\n        }\n      }));\n    }\n\n  }\n\n  _defineProperty(App, \"propTypes\", {\n    user: PropTypes.shape({\n      username: PropTypes.string,\n      email: PropTypes.string.isRequired\n    }),\n    isFromServer: PropTypes.bool.isRequired\n  });\n\n  _defineProperty(App, \"defaultProps\", {\n    user: null\n  });\n\n  return App;\n}\n\nexport default withAuth;","map":{"version":3,"sources":["C:/my-projects/shoe-store/lib/withAuth.js"],"names":["React","PropTypes","Router","globalUser","withAuth","BaseComponent","loginRequired","logoutRequired","App","Component","componentDidMount","user","isFromServer","props","push","getInitialProps","ctx","req","toObject","_id","toString","console","log","Object","assign","render","shape","username","string","email","isRequired","bool"],"mappings":";;;;;;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,OAAOC,MAAP,MAAmB,aAAnB;AAEA,IAAIC,UAAU,GAAG,IAAjB;;AAEA,SAASC,QAAT,CAAkBC,aAAlB,EAAiC;AAAEC,EAAAA,aAAa,GAAG,IAAlB;AAAwBC,EAAAA,cAAc,GAAG;AAAzC,IAAmD,EAApF,EAAwF;AACvF,QAAMC,GAAN,SAAkBR,KAAK,CAACS,SAAxB,CAAkC;AAajCC,IAAAA,iBAAiB,GAAG;AACnB,YAAM;AAAEC,QAAAA,IAAF;AAAQC,QAAAA;AAAR,UAAyB,KAAKC,KAApC;;AAEA,UAAID,YAAJ,EAAkB;AACjBT,QAAAA,UAAU,GAAGQ,IAAb;AACA,OALkB,CAOnB;;;AACA,UAAIL,aAAa,IAAI,CAACC,cAAlB,IAAoC,CAACI,IAAzC,EAA+C;AAC9CT,QAAAA,MAAM,CAACY,IAAP,CAAY,QAAZ;AACA;AACA,OAXkB,CAanB;;;AACA,UAAIP,cAAc,IAAII,IAAtB,EAA4B;AAC3BT,QAAAA,MAAM,CAACY,IAAP,CAAY,GAAZ;AACA;AACD;;AAED,iBAAaC,eAAb,CAA6BC,GAA7B,EAAkC;AACjC,YAAMJ,YAAY,GAAG,CAAC,CAACI,GAAG,CAACC,GAA3B;AACA,YAAMN,IAAI,GAAGK,GAAG,CAACC,GAAJ,GAAUD,GAAG,CAACC,GAAJ,CAAQN,IAAR,IAAgBK,GAAG,CAACC,GAAJ,CAAQN,IAAR,CAAaO,QAAb,EAA1B,GAAoDf,UAAjE;;AAEA,UAAIS,YAAY,IAAID,IAApB,EAA0B;AACzB;AACAA,QAAAA,IAAI,CAACQ,GAAL,GAAWR,IAAI,CAACQ,GAAL,CAASC,QAAT,EAAX;AACA;;AAED,YAAMP,KAAK,GAAG;AAAEF,QAAAA,IAAF;AAAQC,QAAAA;AAAR,OAAd,CATiC,CAWjC;;AACAS,MAAAA,OAAO,CAACC,GAAR,CAAYT,KAAZ;;AACA,UAAIR,aAAa,CAACU,eAAlB,EAAmC;AAClCQ,QAAAA,MAAM,CAACC,MAAP,CAAcX,KAAd,EAAqB,CAAC,MAAMR,aAAa,CAACU,eAAd,CAA8BC,GAA9B,CAAP,KAA8C,EAAnE;AACA;;AAED,aAAOH,KAAP;AACA;;AAEDY,IAAAA,MAAM,GAAG;AACR,YAAM;AAAEd,QAAAA;AAAF,UAAW,KAAKE,KAAtB;;AAEA,UAAIP,aAAa,IAAI,CAACC,cAAlB,IAAoC,CAACI,IAAzC,EAA+C;AAC9C,eAAO,IAAP;AACA;;AAED,UAAIJ,cAAc,IAAII,IAAtB,EAA4B;AAC3B,eAAO,IAAP;AACA;;AAED,aAAO,MAAC,aAAD,eAAmB,KAAKE,KAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAP;AACA;;AAhEgC;;AADqD,kBACjFL,GADiF,eAEnE;AAClBG,IAAAA,IAAI,EAAEV,SAAS,CAACyB,KAAV,CAAgB;AACrBC,MAAAA,QAAQ,EAAE1B,SAAS,CAAC2B,MADC;AAErBC,MAAAA,KAAK,EAAE5B,SAAS,CAAC2B,MAAV,CAAiBE;AAFH,KAAhB,CADY;AAKlBlB,IAAAA,YAAY,EAAEX,SAAS,CAAC8B,IAAV,CAAeD;AALX,GAFmE;;AAAA,kBACjFtB,GADiF,kBAUhE;AACrBG,IAAAA,IAAI,EAAE;AADe,GAVgE;;AAoEvF,SAAOH,GAAP;AACA;;AAED,eAAeJ,QAAf","sourcesContent":["import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport Router from 'next/router';\r\n\r\nlet globalUser = null;\r\n\r\nfunction withAuth(BaseComponent, { loginRequired = true, logoutRequired = false } = {}) {\r\n\tclass App extends React.Component {\r\n\t\tstatic propTypes = {\r\n\t\t\tuser: PropTypes.shape({\r\n\t\t\t\tusername: PropTypes.string,\r\n\t\t\t\temail: PropTypes.string.isRequired,\r\n\t\t\t}),\r\n\t\t\tisFromServer: PropTypes.bool.isRequired,\r\n\t\t};\r\n\r\n\t\tstatic defaultProps = {\r\n\t\t\tuser: null,\r\n\t\t};\r\n\r\n\t\tcomponentDidMount() {\r\n\t\t\tconst { user, isFromServer } = this.props;\r\n\r\n\t\t\tif (isFromServer) {\r\n\t\t\t\tglobalUser = user;\r\n\t\t\t}\r\n\r\n\t\t\t// If login is required and not logged in, redirect to \"/login\" page\r\n\t\t\tif (loginRequired && !logoutRequired && !user) {\r\n\t\t\t\tRouter.push('/login');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// If logout is required and user logged in, redirect to \"/\" page\r\n\t\t\tif (logoutRequired && user) {\r\n\t\t\t\tRouter.push('/');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tstatic async getInitialProps(ctx) {\r\n\t\t\tconst isFromServer = !!ctx.req;\r\n\t\t\tconst user = ctx.req ? ctx.req.user && ctx.req.user.toObject() : globalUser;\r\n\r\n\t\t\tif (isFromServer && user) {\r\n\t\t\t\t// Convert \"_id\"(ObjectID from MongoDB) object to string\r\n\t\t\t\tuser._id = user._id.toString();\r\n\t\t\t}\r\n\r\n\t\t\tconst props = { user, isFromServer };\r\n\r\n\t\t\t// Call child component's \"getInitialProps\", if it is defined\r\n\t\t\tconsole.log(props);\r\n\t\t\tif (BaseComponent.getInitialProps) {\r\n\t\t\t\tObject.assign(props, (await BaseComponent.getInitialProps(ctx)) || {});\r\n\t\t\t}\r\n\r\n\t\t\treturn props;\r\n\t\t}\r\n\r\n\t\trender() {\r\n\t\t\tconst { user } = this.props;\r\n\r\n\t\t\tif (loginRequired && !logoutRequired && !user) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\tif (logoutRequired && user) {\r\n\t\t\t\treturn null;\r\n\t\t\t}\r\n\r\n\t\t\treturn <BaseComponent {...this.props} />;\r\n\t\t}\r\n\t}\r\n\r\n\treturn App;\r\n}\r\n\r\nexport default withAuth;\r\n"]},"metadata":{},"sourceType":"module"}